@model IEnumerable<ClientsProject.Models.Client>

@{
    ViewBag.Title = "Clients";
}



<h2>ClientsList</h2>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <script src="~/scripts/jquery-3.3.1.min.js"></script>
    <script src="~/scripts/bootstrap.min.js"></script>
    <link href="~/Content/dataTables.bootstrap4.min.css" rel="stylesheet" />
    <script src="~/scripts/jquery.dataTables.min.js"></script>
    <script src="~/scripts/dataTables.bootstrap4.min.js"></script>
    <script type="text/javascript">

    </script>
</head>
<p>

    @Html.ActionLink("Create New", "Create")

    @using (Html.BeginForm())
    {
    <p>
        Search by phone number: @Html.TextBox("SearchString") <br />
        <input type="submit" value="Run" />
    </p>
}
    </p>
    <div id="tasks"></div>
    @section scripts
{
        <script type="text/javascript">

            var count = 0;
            $(function () {
                
                $('input[type=checkbox]').click(function () {
                    if (this.checked) {
                        count++;
                    } else {
                        count--;
                    }
                    
                });
            });
            
            function updateMonitor(taskId, status) {
                $("#P" + taskId).css("width", status + "%");
                if (status > 0 && status < 100) {
                    $("#" + taskId).html("Delete " + count + " from: " + @Model.Count() + " recordings " + "/Progress: " + status + "%");
                    $('#P' + taskId).html(status + '%');
                } else {
                    $("#" + taskId).html("Deletion process: " + status);
                    $("#P" + taskId).css("width", 100 + "%");
                    $('#P' + taskId).html(status);
                }

            }


            $(function () {
                $("#start2").click(function (e) {
                    e.preventDefault();

                    $.post("/Clients/Start", {}, function (taskId) {

                        // init
                        $("#tasks").append($("<p id='" + taskId + "'><div class='progress progress-striped active'><div id='P" + taskId + "' class='progress-bar' style='width:1%;'></div></div></p>"));

                        // update
                        var intervalId = setInterval(function () {
                            $.post("/Clients/Progress", { id: taskId }, function (progress) {
                                if (progress >= 100) {
                                    updateMonitor(taskId, "Completed");
                                    clearInterval(intervalId);
                                    $("#tasks").html('');

                                    $("#myForm").submit();

                                } else {
                                    updateMonitor(taskId, progress);

                                }
                            });
                        }, 100);
                    });

                });
            });
        </script>   
    }
<div class="col-md-offset-2 col-md-10">

    <button id="start2" type="submit" value="DeleteSelected" class="btn btn-sm btn-danger rounded-0" @*onclick="return confirm('Are you sure?')"*@><i class="fa fa-trash-o"></i> Delete selected</button>
</div>
    @using (Html.BeginForm("DeleteSelected", "Clients", FormMethod.Post, new { id = "myForm" }))
    {
        
        

        <table class="table">
            <tr>
                <th>

                </th>
                <th>
                    @Html.DisplayNameFor(model => model.FirstName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.MiddleName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.LastName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Phone)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Email)
                </th>
                <th></th>
            </tr>

            @foreach (var item in Model)
            {
                <tr>
                    <td><input type="checkbox" name="ID" value="@item.ID" class="custom-checkbox chkCheckBoxId" /></td>


                    <td>
                        @Html.DisplayFor(modelItem => item.FirstName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.MiddleName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.LastName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Phone)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Email)
                    </td>
                    <td>
                        @Html.ActionLink("Edit", "Edit", new { id = item.ID }) |
                        @Html.ActionLink("Details", "Details", new { id = item.ID }) |
                        @Html.ActionLink("Delete", "Delete", new { id = item.ID })
                    </td>
                </tr>

            }


        </table>


    }



    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">


